$(window)
	.on('load', fadeInContent)
	.on('scroll', toggleNav)
	.on('scroll', fadeOutHero)
	.on('scroll', fadeOutText);

// Wait until image is loaded
function fadeInContent () {
	$('.c-loading-screen').fadeOut(600, function () {
		$('.c-hero__inner').fadeIn(600);
	});
};

// Toggle nav active state
function toggleNav () {
	var heroHeight = $('.c-hero').outerHeight();
	var scrollTop = $(window).scrollTop();

	if (scrollTop >= heroHeight) {
		$('.c-nav--sticky').addClass('c-nav--active');
	} else {
		$('.c-nav--sticky').removeClass('c-nav--active');
	}
};

// Fade hero to #black on scroll down
function fadeOutHero () {
	var scrollTop = $(window).scrollTop();
	var heroHeight = $('.c-hero').outerHeight();

	if (scrollTop < heroHeight) {
		$('.c-hero__overlay').css({
			'opacity': scrollTop / $(this).height()
		});
	}
};

// Fade out hero content on scroll down
function fadeOutText () {
	var scrollTop = $(window).scrollTop();
	var heroHeight = $('.c-hero').outerHeight();
	var height = heroHeight / 2;
	var $arrow = $('.c-hero__arrow');
	var activeClass = 'c-hero__arrow--active';

	if (scrollTop < heroHeight) {
		if (scrollTop > 0) {
			$arrow.removeClass(activeClass);
		} else {
			$arrow.addClass(activeClass);
		}

		$('.js-fade-hero-content').css({
			'opacity': ((height - scrollTop) / height)
		});
	}
};

// Hide nav on scroll down
(function () {
	var didScroll;
	var lastScrollTop = 0;
	var delta = 5;
	var navbarHeight = $('.c-nav--sticky').outerHeight();

	$(window).scroll(function (event) {
		didScroll = true;
	});

	setInterval(function () {
		if (didScroll) {
			hasScrolled();
			didScroll = false;
		}
	}, 250);

	function hasScrolled () {
		var st = $(this).scrollTop();

		// Make sure they scroll more than delta
		if (Math.abs(lastScrollTop - st) <= delta) {
			return;
		}
		// If they scrolled down and are past the navbar, add class .c-nav--hide.
		// This is necessary so you never see what is "behind" the navbar.
		if (st > lastScrollTop && st > navbarHeight) {
			// Scroll Down
			$('.c-nav--sticky').addClass('c-nav--hide');
		}
		else if (st + $(window).height() < $(document).height()) {
			// Scroll Up
			$('.c-nav--sticky').removeClass('c-nav--hide');
		}

		lastScrollTop = st;
	}

})();

// Internal linking
$('body').on('click', '.js-go-to-section', function (e) {
	var $section = $($(this).attr('href'));
	e.preventDefault();

	$('html, body').animate({
		scrollTop: $section.offset().top
	}, 400);
});

// Delete article
$('body').on('click', '.c-edit__link--delete', function (e) {
	e.preventDefault();

	if (confirm('Are you sure you want to delete this article?')) {
		$.ajax({
			type: 'delete',
			url: $(this).attr('href'),
			success: function (response) {
				// reload page
				window.location.reload();
			}
		});
	}
});

// Initialize TinyMCE
$(function () {
	var script = $('script[src="/js/vendor/tinymce/tinymce.js"]');

	if (script.length) {
		tinymce.init({
			selector: '.c-form__wysiwyg',
			content_css: '/js/vendor/tinymce/skins/custom/custom-theme.css',
			plugins: 'codesample, fullscreen, paste',
			toolbar: 'codesample, fullscreen'
		});
	}
});

// Remove empty p tags generated by tinyMCE
$('p').each(function() {
	var $this = $(this);
	if($this.html().replace(/\s|&nbsp;/g, '').length === 0) {
		$this.remove();
	}
});

// If no cookie
if (!Cookies.get('info')) {
	$('.c-info-bar').show();
	$('body').on('click', '.c-info-bar__close', function () {
		var $nav = $('.c-nav');
		$(this).closest('.c-info-bar').slideUp(200);
		if (!$nav.hasClass('c-nav--sticky')) {
			$nav.addClass('c-nav--sticky');
		}
		// Set cookie for 24 hours
		var date = new Date();
		date.setTime(date.getTime() + 24 * 60 * 60 * 1000);
		Cookies.set('info', true, {expires: date});
	});
}

$(function () {
	if ($('.c-info-bar').length) {
		$('.c-nav').removeClass('c-nav--sticky');
	}
});